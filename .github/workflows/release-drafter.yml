name: Release Drafter

name-template: $RESOLVED_VERSION
tag-template: v$RESOLVED_VERSION
change-template: "- $TITLE @$AUTHOR (#$NUMBER)"
version-resolver:
  major:
    labels:
      - major
  minor:
    labels:
      - minor
  patch:
    labels:
      - patch
  default: patch
categories:
  - title: ':rocket: Features'
    label: feat
  - title: ':bug: Bug Fixes'
    label: fix
  - title: ':racehorse: Performance'
    label: perf
  - title: ':penguin: Developer Changes'
    labels:
      - chore
      - refactor
      - style
      - test
  - title: ':pencil: Documentation'
    labels:
      - docs
  - title: ':wrench: DevOps'
    labels:
      - ci
      - build
exclude-labels:
  - skip-changelog
replacers:
  # Strip semantic PR title prefixes
  - search: /(build|ci|chore|docs|feat|fix|perf|refactor|style|test)\((\w+)\):\s?/g
    replace: "$2: "
  - search: /(build|ci|chore|docs|feat|fix|perf|refactor|style|test):\s?/g
    replace: ""
  - search: VERSION_OK_TMP
    replace: "YES"
autolabeler:
  - label: minor
    title:
      - /^feat/
  - label: feat
    title:
      - /^feat/
  - label: fix
    title:
      - /^fix/
  - label: perf
    title:
      - /^perf/
  - label: chore
    title:
      - /^chore/
  - label: style
    title:
      - /^style/
  - label: test
    title:
      - /^test/
  - label: refactor
    title:
      - /^refactor/
  - label: ci
    title:
      - /^ci/
  - label: build
    title:
      - /^build/
  - label: docs
    title:
      - /^docs/
template: |
    VERSION_OK_TMP
    $CHANGES

on:
  push:
    branches:
      - master

jobs:
  update_release_draft:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      # Drafts your next Release notes as Pull Requests are merged into "master"
      # Warning: will clobber manual changes while in draft
      - uses: release-drafter/release-drafter@v5
        with:
          disable-autolabeler: true
          VERSION_OK: "version ok"
        env:
          GITHUB_TOKEN: ${{ secrets.WORKFLOW_ACCESS_TOKEN }}
